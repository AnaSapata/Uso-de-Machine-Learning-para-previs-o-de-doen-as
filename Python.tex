\documentclass{article}

\title{%
		Uso de Machine Learning para previs\~ao de doen\c cas \\
		\large Projeto Integrado - Engenharia Inform\'atica - U\'Evora
		}

\author{Ana Sapata, 42255 \\
		Jos\'e Azevedo, 45414 \\
		Raquel Lopes, 42075}


\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
}
 
\urlstyle{same}

%\usepackage{listings}
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=Python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}
%\lstset{language=Python}
\lstset{
  literate = 
  {ã}{{\~a}}1
  {ç}{{\c c}}1
  {á}{{\'a}}1
  {à}{{\`a}}1
  }

\setlength{\topmargin}{-0.4in}
 \setlength{\topskip}{0.3in}        % between header and text
 \setlength{\textheight}{9.5in}     % height of main text
 \setlength{\textwidth}{6in}        % width of text
 \setlength{\oddsidemargin}{0.1in}  % odd page left margin
 \setlength{\evensidemargin}{0.1in} % even page left margin


\begin{document}
  \maketitle
  \pagebreak
  \section{Introdu\c c\~ao}
  
\qquad \quad Este trabalho \'e realizado no \^ambito da disciplina de Projeto Integrado, da licenciatura de Engenharia Inform\'atica da Universidade de \'Evora.

\quad Como objetivos do mesmo pretende-se aprender a utilizar bibliotecas especificas do Pyhton como o Numpy, Matplotlib e Scikit-Learning, utilizadas em projetos relacionados com Machine Learning. Sendo assim, o trabalho consiste na realização de um projeto na \'area de Machine Learning, mais concretamente na implementa\c c\~ao do artigo “Building meaningful machine learning models for disease prediction” (\url{https://shiring.github.io/machine_learning/2017/03/31/webinar_code}) em Pyhton, atraves das bibliotecas anteriormente referidas.

\quad Primeiramente ir\~ao ser apresentados conceitos b\'asicos de Pyhton, bem como das bibliotecas a utilizar, passando de seguida \`a implemanta\c c\~ao do projeto.
  \section{Python}
  \subsection{Conceitos B\'asicos}
  
  \begin{itemize}
  \item Defini\c c\~ao de variaveis:
  
  \begin{lstlisting}
  <nome_variavel> = <valor>
  \end{lstlisting}
  
  Exemplos:
  
  \begin{lstlisting}
  string = "Olá!"
  inteiro = 4
  decimal = 3.14
  \end{lstlisting}
  
  \item Arrays
  
  Os arrays s\~ao criados com parentesis retos [], estando os elementos do mesmo dentro destes separados por v\'irgulas.
  
  \begin{lstlisting}
  <nome_array> = [elem1, elem2, ..., elemN]
  \end{lstlisting}
  
  Exemplo:
  
  \begin{lstlisting}
  array = [1, 2, 3, "a dog"]
  \end{lstlisting}
  
  \begin{itemize}
  \item Adicionar elementos
  
  Para adicionar elementos a um array utiliza-se o m\'etodo append, seguido do elemento que se pretende adicionar.
  
  Exemplo:
  
  \begin{lstlisting}
  array.append(5)
  print(array)
    [1, 2, 3, "a dog", 5]
  \end{lstlisting}
  
  \item Selecionar elementos de um array
  
  Para se selecionar elementos de um array, utiliza-se o \'indice do elemento que pretendemos selecionar dentro de parentesis retos, a seguir ao nome do array.
  
  Exemplo:
  
  \begin{lstlisting}
  #Selecionar a string "a dog" do array, sendo o seu indice 3
  print(array[3])
  	a dog
  	
  #selecionar o numero 3 do array, sendo o seu indice 2, e atribuir 
  #o mesmo à variavel num
  num = array[2]
  print(num)
  	3
  \end{lstlisting}
  
  \item Eliminar elementos de um array
  
  Para eliminar elementos de um array \'e utilizada a fun\c c\~ao del sendo dado como o seu parametro o nome do array seguido do indice do elemento que se pretende eliminar entre parentesis retos [].
  
  Exemplo:
  
  \begin{lstlisting}
  #queremos apenas que o array contenha numeros, pelo que se irá eliminar 
  #a string "a dog" contido no indice 3
  del(array[3])
  print(array)
  	[1, 2, 3, 5]
  \end{lstlisting}
  
  \item Adicionar elementos num indice especifico
  
  Para se adicionar elementos ao array, num indice especifico \'e utilizado o m\'etodo insert aplicado ao array seguido do indice onde se pretende adicionar e o elemento que se pretende adicionar no mesmo.
  
  \begin{lstlisting}
  <nome_array>.insert(<indice>, <elemento>)
  \end{lstlisting}
  
  Exemplo:
  
  \begin{lstlisting}
  #inserir novamente a string "a dog" no array no indice 3, 
  #onde estava anteriormente
  array.insert(3, "a dog")
  print(array)
  	[1, 2, 3, "a dog", 5]
  \end{lstlisting}
  
  \item Selecionar um subconjunto do array
  
  \begin{lstlisting}
  <nome_array>[indice_inicial:indice_final]
  \end{lstlisting}
  
  Exemplo:
  
  \begin{lstlisting}
  array[2:4]
  	[3, "a dog"]
  \end{lstlisting}
  
  \end{itemize}  
  
  \item Ciclo for
  \begin{lstlisting}
  for <condição>:
	<desenvolvimento do que fará quando se verifica a condição>
  \end{lstlisting}  
  
  Exemplo:
  \begin{lstlisting}
  for x in range (0,3): 
  	print "We're on time" + x 	
  \end{lstlisting}
  Quando x pertence ao intervalo [0;3[ (range(a,b) cria o intervalo/sequencia [a.b[) escreve/imprime a frase We're on time x, substituindo x pelo respetivo valor
  
  \item Ciclo while  
  \begin{lstlisting}
  for <condição>:
	<desenvolvimento do que fará quando se verifica a condição>
  \end{lstlisting} 
  
  Exemplo:
  \begin{lstlisting}
  x = 1  
  while x<3: 
  	print "We're on time" + x
  	x += 1
  \end{lstlisting}
  Enquanto x for inferior a 3, imprime We're on time x, substituindo x pelo respetivo valor, incrementando de seguida 1 ao mesmo
  
  \item Condicionais if/else
  \begin{lstlisting}
  if <condição>:
  	<o que faz se condição verdade>
  else:
  	<o que faz se condição falsa>
  \end{lstlisting}
  
  Exemplo:
  
  \begin{lstlisting}
  num = 3
  if num >= 0:
  	print("Positivo ou zero")
  else:
  	print("Negativo")
  \end{lstlisting}
  Se a variavel num for maior ou igual que zero imprime a frase "Positivo ou zero", caso contr\'ario imprime a frase "Negativo"
  
  \item Defini\c c\~ao de fun\c c\~oes:
  
  \begin{lstlisting}
  def <nome> (<args>):
  	<corpo da função
  	termina com return>
  \end{lstlisting}
  
  Exemplo:
  \begin{lstlisting}
  def soma (a, b):
	return a + b
  \end{lstlisting}  
  
\end{itemize}

\subsection{Numpy}

URL Tutorial:

\url{https://numpy.org/devdocs/user/quickstart.html}

Para utilizar a biblioteca numpy começa-se por utilizar o comando

\begin{lstlisting}
#importação da biblioteca numpy passando a ser denominado por np daqui para a frente
import numpy as np
\end{lstlisting}

Podem criar-se matrizes de zeros ou com os elementos que pretendemos. Para se criar uma matriz de zeros com n linhas e m colunas \'e utilizado o comando 

\begin{lstlisting}
x = np.zeros((n, m))
\end{lstlisting}

Para se criar uma matriz com os elementos pretendidos, \'e utilizada a fun\c c\~ao array da biblioteca numpy, sendo dados como argumentos as linhas da matriz.

Exemplos:

\begin{lstlisting}
#array de zeros com 2 linhas e 3 colunas
x = np.zeros((2, 3))
print(x)
	[[0. 0. 0.]
	 [0. 0. 0.]]

y = np.array([[1, 2], [0,3.2], [1, 7]])
print(y)
	[[1. 2. ]
	 [0. 3.2]
	 [1. 7. ]]
	 
\end{lstlisting}

Para se saber as dimens\~oes da matriz aplica-se o m\'etodo shape \`a matriz em quest\~ao.

\begin{lstlisting}
#a matriz x é composta por 2 linha e 3 colunas
x.shape
	(2,3)

#a matrix y é composta por 3 linhas e 2 colunas	
y.shape
	(3,2)
\end{lstlisting}

Se pretendermos saber o n\'umero total de elementos existentes na matriz aplica-se o m\'etodo size \`a mesma

\begin{lstlisting}
x.size
	6

y.size
	6
\end{lstlisting}

Para al\'em de matrizes tamb\'em \'e poss\'ivel a cria\c c\~ao de arrays, uma vez que estes s\~ao considerados matrizes com apenas uma linha, como \'e poss\'ivel verificar no seguinte exemplo

\begin{lstlisting}
a = np.array([2, 3, 4])
print(a)
	[2 3 4]
\end{lstlisting}

Sendo assim poss\'ivel a construção com n\'umeros num determinado intervalo, para tal \'e utilizada a fun\c c\~ao arange que recebe como argumentos o valor inicial do intervalo, o valor final e o passo utilizado entre cada elemento.

Exemplo:

\begin{lstlisting}
#array cujos elementos começam no valor 10 e terminam no 25, uma vez que o 30 já 
#não irá entrar no intervalo, variando de 5 em 5
b = np.arange(10, 30, 5)
print(b)
	[10 15 20 25]
\end{lstlisting}

Tamb\'em \'e possivel dizer apenas os valores iniciais e finais que pretendemos e o n\'umero de elementos que ir\~ao constituir o array, usando para tal a fun\c c\~ao linspace.

Exemplo:

\begin{lstlisting}
#array cujos elmentos começam no valor 0 e terminam no 2, sendo o mesmo composto 
#por 9 elementos
c = np.linspace(0, 2, 9)
print(c)
	[0. 0.25 0.5 0.75 1. 1.25 1.5 1.75 2.]
\end{lstlisting}


\subsection{Pandas}
URL Getting Started:

\url{https://pandas.pydata.org/pandas-docs/stable/getting_started/index.html}

Tutorial Pandas, implementar


\subsection{Matplotlib}
URL Tutorial:

\url{https://matplotlib.org/tutorials/introductory/usage.html#sphx-glr-tutorials-introductory-usage-py}

\subsection{scikit-learn}
URL Tutorial:

\url{https://scikit-learn.org/stable/tutorial/index.html}
    
\section{Uso de Machine Learning para previs\~ao de doen\c cas}

\quad Os dados utilizados no projeto podem ser obtidos a partir do reposit\'orio de Machine Learning da UCI (\url{http://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+\%28Diagnostic\%29}), estando os mesmos relacionados com o diagnostico de cancro.

\subsection{Tratamento e an\'alise dos dados}

\quad Inicialmente começou por se fazer o download dos dados, e transformar os mesmo no formato de data frame, de modo a facilitar a sua posterior an\'alise.

Para os dados serem carregados no python e ao mesmo tempo transformados numa data frame, foi utilizado o comando \textit{read\_csv} e guardado o resultado na variavel \textit{df}.

\begin{lstlisting}
#importação da biblioteca pandas, quando for necessário usar a mesma irá ser utilizado 
#pd em vez de pandas
import pandas as pd

# Leitura do ficheiro dos dados, especificando que o mesmo não tem nome para as colunas 
#(header = None)

# Comando read_csv da biblioteca Pandas é o equivalente ao read.table do R, uma vez que
# temos o ficheiro em formato csv
df = pd.read_csv('/home/anasapata/Personal/ProjetoIntegrado/Uso-de-Machine-Learning
-para-previs-o-de-doen-as/breast-cancer-wisconsin.data.csv',
                 header = None)

# Mostra as primeiras 5 linhas do ficheiro/data frame
print(df.head())
\end{lstlisting}

Ap\'os guardados os dados na variavel \textit{df}, uma vez que as colunas da data frame n\~ao tinha qualquer nome associado foi necess\'ario atribuir os respetivos nomes a estas.

\begin{lstlisting}
# Uma vez que o ficheiro não tem nome para as colunas, tal como acontece 
# posteriormente com a data frame é então necessário atribuir os respetivos
# nomes às mesmas para tal
df.columns = ['sample_code_number',
              'clump_thickness',
              'uniformity_of_cell_size',
              'uniformity_of_cell_shape',
              'marginal_adhesion',
              'single_epithelial_cell_size',
              'bare_nuclei',
              'bland_chromatin',
              'normal_nucleoli',
              'mitosis',
              'classes']

# Mostrar novamente as primeira 5 linhas de modo a confirmar que os nomes das 
# colunas lhes foram atribuidos
print(df.head())
\end{lstlisting}

De seguida foi tratada a coluna \textit{classes} de modo a ter o valor "benign" quando esta era 2, "malignant" quando era 4 e NA nos restantes casos.

\begin{lstlisting}
# Quando classes tem o valor 2 deverá torna-se "benign", quando tem o valor 4 
# deverá tornar-se "malignant" e nos restantes casos NA
df.classes.replace([2, 4], ['benign', 'malignant'], inplace = True)

# Verificar que alterou os valores
print(df.head())
print(df.tail())
\end{lstlisting}

Uma vez organizada a coluna \textit{classes}, pretende-se agora verificar a exist\^encia de valores NA. Sabe-se que existem celulas cujo seu valor \'e '?' pelo que primeiramente estes valores ter\~ao de passar a NA. O equivalente ao NA na biblioteca numpy \'e o NaN, tendo ent\~ao utilizado este valor quando as c\'elulas tinham o valor '?'.

\begin{lstlisting}
import numpy as np

# Quando existe o valor ? é atribuido ao mesmo o valor NaN (equivalente ao NA)
df.replace('?', np.NaN, inplace = True)
\end{lstlisting}

Ap\'os efetuada a altera\c c\~ao, verificou-se quais as colunas que continham valores NaN e quantas linhas existiam com os mesmos.

\begin{lstlisting}
# Verifica quais as colunas com valores nulos
null_columns = df.columns[df.isnull().any()]

# Conta o número de celulas com valores nulos
print(df[null_columns].isnull().sum())
\end{lstlisting}

Ap\'os efetuada a contagem de celulas que n\~ao t\^em valor, todas as colunas excepto a primeira e ultima s\~ao passadas para o formato numerico, ficando do tipo float64.

\begin{lstlisting}
# Verificar o tipo dos elementos das colunas 1:10 antes de proceder à alteração
print(df.dtypes)

# Passar os elementos das colunas 2:10 para o tipo numerico
df.iloc[:,1:10] = df.iloc[:,1:10].apply(lambda x: pd.to_numeric(x),1)

# Verificar se os elementos das colunas referidas já se encontram todos em formato numerico
print(df.dtypes)
\end{lstlisting}

Para contornar o problema da existencia de celulas sem valores \'e utilizado um m\'etodo para gerar os mesmos, quer seja atrav\'es da m\'edia dos valores dessa coluna quer seja por outro meio. Para tal utilizou a biblioteca scikit-learn eos seus metodos \textit{SimpleImputer} e \textit{IteartiveImputer}, verificando-se que o segundo produz resultados mais semelhantes aos obtidos no R, contudo com algumas diferenças.

\begin{lstlisting}
# https://scikit-learn.org/stable/modules/impute.html
# Informar de como deverá ser feito o impute dos dados
imp = SimpleImputer(missing_values = np.NaN, strategy = 'mean')
# Verificar o que está a ser aplicado
imp.fit(df.iloc[:,1:10])

# Realizar a transformação dos dados
df_impute = imp.transform(df.iloc[:,1:10])
# Uma vez que o df_impute é do tipo numpy.ndarray é utilizado o metodo savetxt do numpy para
# guardar os resultados obtidos e verificar que já não existem NaN
np.savetxt('/home/anasapata/Personal/ProjetoIntegrado/teste.csv', df_impute, delimiter = ";")

# Utilizar outro metodo para impute
imp2 = IterativeImputer(max_iter = 10, random_state = 0)
imp2.fit(df.iloc[:,1:10])
df_impute2 = imp2.transform(df.iloc[:,1:10])
np.savetxt('/home/anasapata/Personal/ProjetoIntegrado/teste_2.csv', df_impute2, delimiter = ";")
\end{lstlisting}

Os dados gerados foram guardados em dois ficheiros de teste de modo a verificar se os mesmos eram iguais aos gerados pelo R. 
Como os dados gerados pelos metodos de impute são no formato numpy.ndarray os mesmos foram transformados numa data frame de modo a ser possivel mais tarde fazer o merge destes com a coluna das classes. Para al\'em disto foram atribuidos aos mesmos os nomes das respetivas colunas bem como alterado o tipo dos dados para inteiros.

\begin{lstlisting}
# Como o resultado do impute é um numpy ndarray existe a necessidade de passar o mesmo para o formato data frame
df_impute2_df = pd.DataFrame(data = df_impute2)

# atribuir o nome das colunas aos dados onde foi resultado o impute
df_impute2_df.columns = ['clump_thickness',
              'uniformity_of_cell_size',
              'uniformity_of_cell_shape',
              'marginal_adhesion',
              'single_epithelial_cell_size',
              'bare_nuclei',
              'bland_chromatin',
              'normal_nucleoli',
              'mitosis']

# Converter todas as colunas para inteiro
df_impute2_df = df_impute2_df.astype('int64')
\end{lstlisting}

Para efetuar o merge entre os dados obtidos pelo m\'etodo do impute e a coluna \textit{classes}, os dados desta ultima foram guardados numa variavel (\textit{cf}), teno posteriormente sido criado um array (\textit{L}) que continha esta coluna e os dados do impute.
Foi utilizado o comando \textit{concat} da biblioteca pandas de modo a fazer o merge das duas data frames contidas no array \textit{L}.

\begin{lstlisting}
# Selecionar a ultima coluna do data frame original para se poder efetuar o merge com os dados com o impute
cf = df.iloc[:,10]

# Colocar todas as data frames a juntar num array
L = [cf, df_impute2_df]
# Fazer o merge de todos os dados
df_final = pd.concat(L, axis = 1)
\end{lstlisting}

Uma vez que os dados da coluna \textit{classes} s\~ao categoricos os mesmos foram alterados para serem deste tipo. Ap\'os esta altera\c c\~ao foram ent\~ao verificados quantos casos de doentes com cancro maligno e benigno exitiam.

\begin{lstlisting}
# Definir a coluna classes como uma variavel categorica
df_final['classes'] = df_final['classes'].astype('category')

ben = df_final[df_final.classes == 'benign']
mal = df_final[df_final.classes == 'malignant']
summary_classes = 'benign     malignant\n' + str(ben.shape[0]) + '        ' + str(mal.shape[0])
print(summary_classes)
\end{lstlisting}

C\'odigo Histograma

\end{document}
